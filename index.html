<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>SettleUp â€“ Expense Splitter</title>
  <meta name="description" content="Free expense splitter to fairly split bills and settle group expenses instantly.">

  <style>
    :root {
      --bg:#f5f5f5;
      --card:#fff;
      --text:#111;
      --accent:#2563eb;
      --border:#ddd;
      --toast:#111;
    }

    body.dark {
      --bg:#0f172a;
      --card:#1e293b;
      --text:#e5e7eb;
      --accent:#60a5fa;
      --border:#334155;
      --toast:#0f172a;
    }

    body[dir="rtl"] {
      text-align: right;
    }

    * { box-sizing: border-box; }

    body {
      margin:0;
      font-family: system-ui, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .container {
      max-width:720px;
      margin:auto;
      padding:20px;
    }

    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    h1 { font-size:1.4rem; }

    .header-actions {
      display:flex;
      gap:6px;
    }

    button {
      background:var(--accent);
      color:#fff;
      border:none;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
    }

    button.secondary {
      background:transparent;
      color:var(--accent);
      border:1px solid var(--accent);
    }

    .card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      margin-top:16px;
    }

    .form {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    input {
      flex:1;
      padding:8px;
      border-radius:6px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
    }

    .list-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:8px;
      gap:8px;
    }

    .actions button {
      padding:4px 8px;
      font-size:.8rem;
    }

    ul {
      padding-left:20px;
    }

    body[dir="rtl"] ul {
      padding-left:0;
      padding-right:20px;
    }

    #qr {
      margin-top:12px;
      text-align:center;
    }

    /* ---------- Toast ---------- */
    .toast {
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      background:var(--toast);
      color:#fff;
      padding:12px 16px;
      border-radius:10px;
      min-width:260px;
      opacity:0;
      pointer-events:none;
      transition:.25s;
    }

    .toast.show {
      opacity:1;
      pointer-events:auto;
      transform:translateX(-50%) translateY(-6px);
    }

    .toast-actions {
      display:flex;
      gap:8px;
      margin-top:8px;
      justify-content:flex-end;
    }

    @media(max-width:600px){
      .form { flex-direction:column; }
    }
  </style>
</head>

<body>
<div class="container">

  <header>
    <h1 id="title">ðŸ’¸ SettleUp</h1>
    <div class="header-actions">
      <button class="secondary" onclick="toggleLang()">AR</button>
      <button class="secondary" onclick="toggleDark()">ðŸŒ™</button>
    </div>
  </header>

  <div class="card">
    <div class="form">
      <input id="name" placeholder="Name">
      <input id="amount" type="number" placeholder="Paid">
      <button onclick="addPerson()" id="addBtn">Add</button>
    </div>
  </div>

  <div class="card" id="peopleList">
    <h3 id="peopleTitle">People</h3>
  </div>

  <div class="card">
    <button onclick="calculate()" id="calcBtn">Calculate</button>
    <button class="secondary" onclick="copyLink()" id="shareBtn">Share</button>
    <button class="secondary" onclick="generateQR()">QR</button>
    <div id="output"></div>
    <div id="qr"></div>
  </div>

</div>

<div id="toast" class="toast"></div>

<script>
/* ---------- State ---------- */
let people = [];
let lang = localStorage.getItem("lang") || "en";

/* ---------- Elements ---------- */
const nameInput = document.getElementById("name");
const amountInput = document.getElementById("amount");
const peopleList = document.getElementById("peopleList");
const output = document.getElementById("output");
const qr = document.getElementById("qr");
const toast = document.getElementById("toast");

/* ---------- i18n ---------- */
const i18n = {
  en: {
    title: "ðŸ’¸ SettleUp",
    name: "Name",
    paid: "Paid",
    add: "Add",
    people: "People",
    calc: "Calculate",
    share: "Share",
    each: "Each pays",
    transactions: "Transactions",
    exists: "already exists"
  },
  ar: {
    title: "ðŸ’¸ ØªØ³ÙˆÙŠØ©",
    name: "Ø§Ù„Ø§Ø³Ù…",
    paid: "Ø§Ù„Ù…Ø¨Ù„Øº",
    add: "Ø¥Ø¶Ø§ÙØ©",
    people: "Ø§Ù„Ø£Ø´Ø®Ø§Øµ",
    calc: "Ø§Ø­Ø³Ø¨",
    share: "Ù…Ø´Ø§Ø±ÙƒØ©",
    each: "Ø­ØµØ© Ø§Ù„ÙØ±Ø¯",
    transactions: "Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª",
    exists: "Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„"
  }
};

function applyLang() {
  document.documentElement.lang = lang;
  document.body.dir = lang === "ar" ? "rtl" : "ltr";

  title.textContent = i18n[lang].title;
  nameInput.placeholder = i18n[lang].name;
  amountInput.placeholder = i18n[lang].paid;
  addBtn.textContent = i18n[lang].add;
  peopleTitle.textContent = i18n[lang].people;
  calcBtn.textContent = i18n[lang].calc;
  shareBtn.textContent = i18n[lang].share;
}

function toggleLang() {
  lang = lang === "en" ? "ar" : "en";
  localStorage.setItem("lang", lang);
  applyLang();
}

applyLang();

/* ---------- Dark Mode ---------- */
function toggleDark() {
  document.body.classList.toggle("dark");
}

/* ---------- Helpers ---------- */
function normalizeName(name) {
  if (/^[a-zA-Z]/.test(name)) {
    return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
  }
  return name;
}

function showToast(msg) {
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2200);
}

/* ---------- CRUD ---------- */
function addPerson() {
  let name = nameInput.value.trim();
  const amount = parseFloat(amountInput.value);
  if (!name || isNaN(amount)) return;

  name = normalizeName(name);
  const idx = people.findIndex(p => p.name.toLowerCase() === name.toLowerCase());

  if (idx !== -1) {
    people[idx].amount += amount;
    showToast(`${name} ${i18n[lang].exists}`);
  } else {
    people.push({ name, amount });
  }

  nameInput.value = "";
  amountInput.value = "";
  render();
  calculate();
}

/* ---------- Render ---------- */
function render() {
  peopleList.innerHTML = `<h3>${i18n[lang].people}</h3>`;
  people.forEach((p, i) => {
    peopleList.innerHTML += `
      <div class="list-item">
        <span>${p.name} â€” ${p.amount}</span>
        <div class="actions">
          <button onclick="people.splice(${i},1); render(); calculate();">âœ•</button>
        </div>
      </div>
    `;
  });
}

/* ---------- Calculation (Grouped) ---------- */
function calculate() {
  if (!people.length) return;

  const total = people.reduce((s,p)=>s+p.amount,0);
  const share = +(total / people.length).toFixed(2);

  let bal = people.map(p => ({ name:p.name, b:+(p.amount-share).toFixed(2) }));
  let cred = bal.filter(x=>x.b>0);
  let debt = bal.filter(x=>x.b<0).map(x=>({name:x.name,b:-x.b}));

  const grouped = {};

  let i=0,j=0;
  while(i<debt.length && j<cred.length){
    const amt = Math.min(debt[i].b, cred[j].b);
    grouped[debt[i].name] ??= [];
    grouped[debt[i].name].push(`${cred[j].name} : ${amt.toFixed(2)}`);
    debt[i].b -= amt;
    cred[j].b -= amt;
    if(!debt[i].b) i++;
    if(!cred[j].b) j++;
  }

  output.innerHTML = `
    <p><strong>${i18n[lang].each}:</strong> ${share}</p>
    <h4>${i18n[lang].transactions}</h4>
    ${Object.entries(grouped).map(([k,v])=>`
      <p><strong>${k}</strong></p>
      <ul>${v.map(t=>`<li>â†’ ${t}</li>`).join("")}</ul>
    `).join("")}
  `;
}

/* ---------- Share ---------- */
function copyLink() {
  navigator.clipboard.writeText(location.href);
  showToast("Copied");
}

function generateQR() {
  qr.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(location.href)}">`;
}
</script>
</body>
</html>